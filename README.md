总结报告
本次实习聚焦于研究神经网络在织物渲染上的应用。通过与传统渲染方法进行对比，了解神经网络材质的优势与不足。
一、织物渲染简介
传统渲染一般将织物建模为层次结构，从细到粗依次为fiber、ply、yarn、cloth。Fiber作为最小的结构通过与其他fiber相互纠缠形成ply，而ply同时也和其他ply相互纠缠形成yarn，最后yarn以各种的交织方式形成织物。Fiber的材料和每个层次的几何结构都会极大的影响织物最终的呈现。
目前织物渲染的挑战性在于对织物几何结构的精确表达以及光线在其上的多重散射。主流的研究方法分为基于曲线的模型和基于表面的模型。基于曲线的模型显式的表达fiber、ply、yarn等元素，能实现较为精确的渲染但其所需时间和内存较大；而基于表面的模型使用数据驱动，直接将织物视为二维表面，能更加高效的进行渲染，但对织物一些细节的还原仍有待提高。
二、应用神经网络的织物渲染
《Neural Appearance Model for Cloth Rendering》使用神经网络建模基于表面的模型，并结合传统渲染完成其余部分的渲染。具体来说，该论文将织物的渲染分为三个部分：直接反射、直接透射、多重散射。

直接反射指光线和织物有且仅有一次相交（包括反射和折射），在渲染结果上表现为高光部分。该部分采用传统的解析方法，从fiber层次出发，将BSDF分为反射和折射两个部分，并将轴向和横向的角度分布解耦从而降低表达的复杂度。
直接透射指光线不与织物相交而直接穿过织物，在渲染结果上表现为透明部分。该部分BSDF直接使用δ函数表达。计算光线与fiber是否相交这一步在传统渲染中占用大量的资源。因此，该论文采用神经网络（MLP）来近似，通过入射光线方向来决定光线是否透过织物。
多重散射指光线在织物上多次弹射，在渲染结果上表现为细节部分。同样采用神经网络（MLP），根据入射方向和出射方向来决定BSDF。
MLP使用reference的多角度渲染结果进行训练，即将立体角均分，每个部分都会对单根yarn使用传统方式进行渲染，得到一份数据。 

从实验结果可以看出采用神经网络方法在保证渲染质量的同时，能大大降低消耗的时间和内存。
然而，正如前文所说，基于表面的模型在几何细节的表达上仍有不足。神经网络方法在cloth层级表现良好，但具体到单根yarn的部分就存在明显的失真。
 
实际上，从reference可以看出，fiber在yarn上并不是均匀分布的，并且fiber之间也存在空隙，边缘部分也凹凸不平。该论文的渲染结果无法表达出复杂的几何结构。神经网络在训练时只有入射出射光线作为网络输入，而与具体的入射出射点的位置无关，如此的训练方式便假设fiber在yarn上的分布是均匀统一的，因此表现出平滑的表面。同时，神经网络的灵活性和实用性实际上非常有限，因为神经网络的结构与fiber的具体参数（密度、纠缠方式、反射率）息息相关，如果需要对织物的参数进行微调，那么就需要重新训练网络，而网络训练本身非常耗时间。另外，神经网络在LOD上的灵活性与传统方法相比仍有不足，特别是当yarn只占据一格像素时。
三、其他基于表面的模型
以《A Realistic Surface-based Cloth Rendering Model》为例，该论文没有采用神经网络而是使用统计+预计算的方式，基于表面模型渲染织物。该论文同样在cloth层级实现了准确的渲染，但未对yarn层级进行测试。与上篇论文不同，该论文直接与现实布料进行对比，并测量得到若干特征图，如ID map（表面是否存在织物）、ply normal/tangent map、position map（ply相比于基准面的偏移）。使用特征图可以很好的避免具体几何细节的缺失。不过由于该论文并没有开源代码，因此无法参考其具体实现。针对上篇论文，可以使用传统渲染方式得到特征图的数据样本（和渲染图片类似，修改fiber上的反射率即可），然后进行训练，根据得到的特征图修改BSDF。具体来说，直接反射部分需要额外过滤ID map上为0的渲染点，并根据normal/position map修正对应的法线与位移；直接透射和多重散射部分可以考虑将特征图编码，并入MLP的输入中，在控制MLP参数数量变化不大的同时能更好的适应空间上的变化。由于实习时间有限，具体实现仍在尝试中，实际效果也有待验证。
《A Realistic Multi-scale Surface-based Cloth Appearance Model》以上一段中提到的论文为基础，额外实现了视差以及边缘的绒毛效果，并与其他部分耦合较小。以该论文的模型作为reference也能更加使得渲染结果更加真实、准确。
四、总结
